name: hydra-sandbox

services:
  generic:
    build:
      context: ..
      dockerfile: docker/sandbox/Dockerfile.generic
    image: hydra/sandbox-generic:local
    command: ["sleep", "infinity"]
    working_dir: /workspace
    read_only: true
    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=64m
      - /workspace:rw,noexec,nosuid,nodev,size=256m
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    network_mode: "none"
    pids_limit: 256
    mem_limit: 512m
    cpus: 1.0
    restart: "no"
    profiles:
      - generic

  solana-validator:
    build:
      context: ..
      dockerfile: docker/sandbox/Dockerfile.solana
    image: hydra/sandbox-solana:local
    command:
      [
        "solana-test-validator",
        "--ledger",
        "/tmp/ledger",
        "--reset",
        "--rpc-bind-address",
        "127.0.0.1",
        "--bind-address",
        "127.0.0.1",
        "--quiet",
      ]
    working_dir: /workspace
    read_only: true
    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=1g
      - /workspace:rw,noexec,nosuid,nodev,size=256m
      - /home/hydra:rw,noexec,nosuid,nodev,size=64m
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    network_mode: "none"
    pids_limit: 512
    mem_limit: 2g
    cpus: 2.0
    restart: "no"
    profiles:
      - solana

  solana-runner:
    image: hydra/sandbox-solana:local
    command: ["sleep", "infinity"]
    working_dir: /workspace
    read_only: true
    tmpfs:
      - /tmp:rw,noexec,nosuid,nodev,size=256m
      - /workspace:rw,noexec,nosuid,nodev,size=256m
      - /home/hydra:rw,noexec,nosuid,nodev,size=64m
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    network_mode: "service:solana-validator"
    depends_on:
      - solana-validator
    pids_limit: 256
    mem_limit: 1g
    cpus: 1.0
    restart: "no"
    profiles:
      - solana
